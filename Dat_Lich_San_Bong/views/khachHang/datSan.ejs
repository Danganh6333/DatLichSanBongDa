<div class="header">
    <button class="header-btn">ƒê·ªïi L·ªãch Nhanh</button>
    <select class="header-dropdown">
        <% sanBongs.forEach(sanBong=> { %>
            <option value="<%= sanBong._id %>">
                <%= sanBong.tenSan %>
            </option>
            <% }) %>
    </select>
    <button class="header-btn" onclick="openAppointment()">ƒêi·ªÅn Th√¥ng Tin</button>
</div>
<div class="appointments">
    <section class="notes">
        <h2>Ch√∫ Gi·∫£i Tr·∫°ng Th√°i</h2>
        <div class="status-item">
            <span class="status-icon">‚è∞</span>
            <p>Sau th·ªùi gian cho ph√©p ƒë·∫∑t</p>
        </div>
        <div class="status-item">
            <span class="status-icon">üü¢</span>
            <p>Tr·∫°ng th√°i m·ªõi ƒë·∫∑t</p>
        </div>
        <div class="status-item">
            <span class="status-icon">üî¥</span>
            <p>S√¢n ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t h·∫øt</p>
        </div>

        <h2>Sau Khi Thanh To√°n</h2>
        <div class="status-item">
            <span class="status-icon">‚öΩ</span>
            <p>Tr·∫°ng th√°i ƒëang ƒë√°</p>
        </div>
        <div class="status-item">
            <span class="status-icon">üö´</span>
            <p>Tr·∫°ng th√°i Ch·ªù nh·∫≠n s√¢n</p>
        </div>
        <div class="status-item">
            <span class="status-icon">üí∞</span>
            <p>Tr·∫°ng th√°i Ch·ªù thanh to√°n</p>
        </div>
        <div class="status-item">
            <span class="status-icon">‚ùå</span>
            <p>Tr·∫°ng th√°i ƒê·∫∑t nh∆∞ng kh√¥ng ƒë√°</p>
        </div>
    </section>
    <section class="calendars">
        <div id="calendar"></div>
    </section>
    <section class="event">
        <h2>S·ª± Ki·ªán</h2>
        <table>
            <thead>
                <tr>
                    <th>Th√¥ng tin ca</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Th√¥ng tin ca 1</td>
                    <td><button class="action-btn">Xem</button></td>
                </tr>
                <tr>
                    <td>Th√¥ng tin ca 2</td>
                    <td><button class="action-btn">Xo√°</button></td>
                </tr>
            </tbody>
        </table>
    </section>
</div>
<div class="form-popup" id="myForm">
    <form action="" class="form-container">
        <h2 class="form-title">
            L·ª±a Ch·ªçn Ca
            <span class="close-icon" onclick="closeForm()">&#215;</span>
        </h2>
        <div class="caLamViec-grid">
            <% caLamViecs.forEach(element=> { %>
                <button type="button" class="caLamViec-item"
                    onclick="selectCa('<%= element._id %>', '<%= element.tenCa %>', '<%= element.gioBatDau %>', '<%= element.gioKetThuc %>', '<%= element.tongTien %>', event)">
                    <p><strong>
                            <%= element.tenCa %>
                        </strong>: <%= element.gioBatDau %> - <%= element.gioKetThuc %>
                    </p>
                    <p>Gi√° Ti·ªÅn: <%= element.tongTien %>
                    </p>
                </button>
                <% }) %>
        </div>
        <div class="button-group">
            <button type="button" class="btn save" onclick="saveEvent()">L∆∞u Ca</button>
        </div>
    </form>
</div>
<div class="form-popup" id="addAppointment">
    <form action="" class="form-container">
        <h2 class="form-title">ƒê·∫∑t S√¢n</h2>
        <table>
            <tr>
                <th>Ca</th>
                <th>Ng√†y</th>
                <th>Gi√° S√¢n</th>
                <th>Thao t√°c</th>
            </tr>
            <tr>
                <td>
                    <select class="header-dropdown">
                        <% sanBongs.forEach(sanBong=> { %>
                            <option value="<%= sanBong._id %>">
                                <%= sanBong.tenSan %>
                            </option>
                            <% }) %>
                    </select>
                </td>
                <td>
                    <input type="date" value="2017-06-01" />
                </td>
                <td>
                    <input type="number" name="" id="" placeholder="Nh·∫≠p gi√°">
                </td>
                <td class="button-group">
                    <button>Th√™m Ca</button>
                </td>
            </tr>
        </table>
        <p></p>
        <button type="button" class="btn cancel" onclick="closeAppointment()">Close</button>
    </form>
</div>
<script type="text/javascript">
  let selectedDate = '';
let selectedCa = null;
let calendar;

function toggleDropdown() {
    const dropdown = document.getElementById("profileDropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
}

window.onclick = function (event) {
    if (!event.target.closest('.profile')) {
        document.getElementById("profileDropdown").style.display = "none";
    }
}

function selectCa(id, tenCa, gioBatDau, gioKetThuc, tongTien, event) {
    selectedCa = {
        _id: id,
        tenCa: tenCa,
        gioBatDau: gioBatDau,
        gioKetThuc: gioKetThuc,
        tongTien: tongTien
    };

    document.querySelectorAll('.caLamViec-item').forEach(el => el.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
}

document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        selectable: true,
        dateClick: function (info) {
            console.log('Clicked on: ' + info.dateStr);
            selectedDate = info.dateStr;
            openForm();
        },
    });
    calendar.render();
});

function openForm() {
    closeAllPopups();
    document.getElementById("myForm").style.display = "block";
}

function closeForm() {
    document.getElementById("myForm").style.display = "none";
}

function openAppointment() {
    closeAllPopups();
    document.getElementById("addAppointment").style.display = "block";
}

function closeAppointment() { 
    document.getElementById("addAppointment").style.display = "none";
}

function closeAllPopups() {
    closeForm();
    closeAppointment();
}

function saveEvent() {
    if (selectedDate && selectedCa) {
        calendar.addEvent({
            title: selectedCa.tenCa,
            start: selectedDate + 'T' + selectedCa.gioBatDau,
            end: selectedDate + 'T' + selectedCa.gioKetThuc,
            description: selectedCa.tongTien + ' VND',
            allDay: false
        });
        closeForm();
    } else {
        console.error('Please select a valid caLamViec.');
    }
}

</script>